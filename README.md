<h1 align="center">
RSCC: A Rule-Based Soft Compression Multi-Agent Framework for
Efficient Code Generation in Large-Scale Software Projects
</h1>
<p align="center">
<img src="https://img.shields.io/badge/OS-Ubuntu22.4-blue" />
<img src="https://img.shields.io/badge/Python-3.10-red" />
<img src="https://img.shields.io/badge/Build-Success-green" />
<img src="https://img.shields.io/badge/License-BSD-blue" />
<img src="https://img.shields.io/badge/Release-0.1-blue" />
</p>

<p align="center">
<img src="doc/png/fig.codeagents.png" width=80%/> <br>
<b>Figure 1</b>. Structure of RSCC.
</p>


## Conda Enviroment Setup

``` shell
conda create -n RSCC python=3.10
conda activate RSCC
# CUDA 12.1
conda install pytorch==2.1.0 torchvision==0.16.0 torchaudio==2.1.0 pytorch-cuda=12.1 -c pytorch -c nvidia
# OR CUDA 11.8
# conda install pytorch==2.1.0 torchvision==0.16.0 torchaudio==2.1.0 pytorch-cuda=11.8 -c pytorch -c nvidia
# OR CPU Only
# conda install pytorch==2.1.0 torchvision==0.16.0 torchaudio==2.1.0 cpuonly -c pytorch
pip install packaging
pip install transformers==4.34.0 datasets==2.13.4 accelerate==0.24.1 sentencepiece==0.1.99 flash-attn==2.3.5 wandb
# Flash rotary embeddings (requires setting correct CUDA_HOME variable)
pip install git+https://github.com/Dao-AILab/flash-attention.git#subdirectory=csrc/rotary
```

## DataSet
### Task1. Code Generation
The task evaluates the integration of RSCC as a soft prompt compressor in multi-agent code generation systems. The experimental framework leverages CodeXGLUE to provide a diverse set of programming problems across Python, Java, and JavaScript. Subsets of these languages are partitioned into training, validation, and test sets at an 8:1:1 ratio, ensuring robust evaluation of code generation capabilities. Each instance requires agents to generate code while dynamically compressing prompts using RSCC to optimize context length and maintain global coherence.

**Dataset Address**:  
https://github.com/microsoft/CodeXGLUE

**Access Method (Python)**:
```python
from datasets import load_dataset

# Load CodeXGLUE dataset via HuggingFace Datasets
dataset = load_dataset("microsoft/codexglue", "code-generation")
train_data = dataset["train"]
test_data = dataset["test"]

# Alternative direct download (requires git)
import os
os.system("git clone https://github.com/microsoft/CodeXGLUE.git")
os.system("cd CodeXGLUE && unzip -q code-generation/data.zip")
```
### Task2. Industrial-Grade Code Robustness Validation
This task assesses the reliability of code generated by multi-agent systems under real-world constraints. Three benchmarks are employed: HumanEval-ET , MBPP-ET , and EvalPlus. These datasets focus on edge cases, syntactic and semantic correctness, and adversarial robustness. The goal is to validate whether RSCC-enhanced code generation can produce industrial-grade solutions that pass rigorous testing scenarios.

**Dataset Address**:  
Benchmarks:
HumanEval-ET: https://github.com/evalplus/evalplus  
MBPP-ET: https://github.com/evalplus/evalplus

**Access Method (Python)**:
```python
# Download HumanEval-ET
import requests, zipfile
url = "https://github.com/evalplus/evalplus/archive/refs/heads/main.zip"
r = requests.get(url)
with open("evalplus-main.zip", "wb") as f:
    f.write(r.content)
with zipfile.ZipFile("evalplus-main.zip", "r") as zip_ref:
    zip_ref.extractall()

# Access MBPP-ET from HuggingFace
from datasets import load_dataset
mbpp_dataset = load_dataset("mbpp", "mbpp")

```
### Task3. Cross-Domain Prompt Compression Generalization
This task validates the cross-domain effectiveness of RSCC by evaluating its performance on HotpotQA, a multi-hop reasoning dataset. The goal is to compress complex, multi-sentence prompts into concise soft prompts while preserving critical information for downstream tasks (e.g., code generation). The evaluation measures whether RSCC can generalize across domains, such as transitioning from natural language reasoning to code generation.

**Dataset Address**:  
https://hotpotqa.github.io/

**Access Method (Python)**:
```python
import requests, tarfile

# Download HotpotQA v1.1
url = "https://s3.amazonaws.com/my89public/hotpot_train_v1.1.tar.gz"
response = requests.get(url, stream=True)
with open("hotpot_train_v1.1.tar.gz", "wb") as f:
    for chunk in response.iter_content(chunk_size=1024):
        if chunk:
            f.write(chunk)

# Extract data
with tarfile.open("hotpot_train_v1.1.tar.gz", "r:gz") as tar:
    tar.extractall()
```

## Usage
### 1. Move the code of the large project to the directory '/RSCC/large_scale_project'
### 2. Run the program using the following command
For example:
```python
python startup.py --user_requirement "Create a mobile app for the 2048 game"
```

## Case Study
![Case Study](doc/png/CaseStudy.png)

[//]: # (<img src="doc/png/CaseStudy.png" width=80%/> <br>)